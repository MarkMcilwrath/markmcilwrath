<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon" href="#">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.min.js"></script>
</head>
<body onload="getVendors()">
	<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#allVendorsModal" onclick='rebuildTable()' >All Vendors</button>

<div id="allVendorsModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">All Vendors</h4>
            </div>
            <div class="modal-body">
                <div class="wrapper">
                    <button id="download-csv" class="btn btn-default">Download CSV</button>
                    <button id="download-json" class="btn btn-default">Download JSON</button>
                    <button id="download-xlsx" class="btn btn-default">Download XLSX</button>
                    <!-- </div>
                    <div class="wrapper"> -->
                    <button id="download-pdf" class="btn btn-default">Download PDF</button>
                    <button id="download-html" class="btn btn-default">Download HTML</button>
                    <button id="print-table"class="btn btn-default" >Print Table</button>
                    </div>
                <div id="allVendors-Table"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="vendorSoftwareModal" class="modal fade" role="dialog">
      <div class="modal-dialog modal-dialog-scrollable modal-lg">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4></h4>
              </div>
              <div class="modal-body">
                  <h4>Software</h4>
                  <div id="software-Table"></div>
                  <br>
                  <h4>Hardware</h4>
                  <div id="hardware-Table"></div>
              </div>

              <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
          </div>
      </div>
  </div>
</body>

<script>
	var tableData;
    var tableData2;
    var table;

	function getVendors()
	    {
	        var xmlHttp = new XMLHttpRequest();
	        var theURL = "http://localhost:8080/vendor"
	        xmlHttp.onreadystatechange = function()
	        {
	            if (this.readyState == 4 && this.status == 200)
	            {
	             tableData = JSON.parse(this.responseText);
                 buildTable();
	            }
	            else
	            {
	            	console.log(this.readyState);
	            	console.log(this.status);
	            }
	        };
	        xmlHttp.open("GET", theURL , true);
	        xmlHttp.send();
	    }

    function rebuildTable()
            {
                table.redraw();
            }

    function buildTable()
    {
        table = new Tabulator("#allVendors-Table",
                {
                     data:tableData,
                layout:"fitColumns",
                paginationSize:5,
                movableColumns:true,
                resizableRows:true,
                printAsHtml:true,
                printHeader:"<h1>All Vendors<h1>",
                    columns:[ 
                    {title:"ID", field:"uuid"},
                    {title:"Name", field:"name", hozAlign:"left"},],
                    rowClick:function(e, row)
                    {
                        var rowData = row.getData();
                        getSoftware(rowData.uuid);
                        getHardware(rowData.uuid);
                        $("#allVendorsModal").modal("toggle");
                        $("#vendorSoftwareModal").modal("toggle");
                    }
                }
            );
    }

    function getSoftware(vendorID)
        {
          var xmlHttp = new XMLHttpRequest();
          var theURL = "http://localhost:8080/software/vendor/" + vendorID
          xmlHttp.onreadystatechange = function()
          {
                
                if (this.readyState == 4 && this.status == 200)
                {
                 var myList2 = (this.responseText);
                 var localTD = JSON.parse(myList2);
                 tableData2 = localTD;
                 console.log(tableData2);
                 
                 buildSoftwareTable();
                }
            };
            xmlHttp.open("GET", theURL , true);
            xmlHttp.send();
        }

        function getHardware(vendorID)
        {
          var xmlHttp = new XMLHttpRequest();
          var theURL = "http://localhost:8080/hardware/vendor/" + vendorID
          xmlHttp.onreadystatechange = function()
          {
                
                if (this.readyState == 4 && this.status == 200)
                {
                 var myList2 = (this.responseText);
                 var localTD = JSON.parse(myList2);
                 tableData3 = localTD;
                 console.log(tableData3);
                 buildHardwareTable();
                }
            };
            xmlHttp.open("GET", theURL , true);
            xmlHttp.send();
        }

        function buildSoftwareTable()
        {
            table = new Tabulator("#software-Table",
            {
                data:tableData2,
                layout:"fitColumns",
                paginationSize:5,
                movableColumns:true,
                resizableRows:true,
                printAsHtml:true,
                printHeader:"<h1>All Software<h1>",
                columns:[ 
                // {title:"ID", field:"uuid"},
                {title:"Name", field:"name", hozAlign:"left"},
                {title:"Version", field:"version", hozAlign:"left"},
                // 
                ]
                    }
                );

        }

        function buildHardwareTable()
        {
            table = new Tabulator("#hardware-Table",
            {
                data:tableData3,
                layout:"fitColumns",
                paginationSize:5,
                movableColumns:true,
                resizableRows:true,
                printAsHtml:true,
                printHeader:"<h1>All Hardware<h1>",
                columns:[ 
                // {title:"ID", field:"uuid"},
                {title:"Name", field:"name", hozAlign:"left"},
                {title:"Model", field:"model", hozAlign:"left"},
                // 
                ]
                    }
                );

        }

    document.getElementById("download-csv").addEventListener("click", function(){
    table.download("csv", "data.csv");});

    //trigger download of data.json file
    document.getElementById("download-json").addEventListener("click", function(){
        table.download("json", "data.json");});

    //trigger download of data.xlsx file
    document.getElementById("download-xlsx").addEventListener("click", function(){
        table.download("xlsx", "data.xlsx", {sheetName:"My Data"});});

    //trigger download of data.pdf file
    document.getElementById("download-pdf").addEventListener("click", function(){
        table.download("pdf", "data.pdf", {
            orientation:"portrait", //set page orientation to portrait
            title:"Example Report", //add title to report
        });});

    //trigger download of data.html file
    document.getElementById("download-html").addEventListener("click", function(){
        table.download("html", "data.html", {style:true});});

    document.getElementById("print-table").addEventListener("click", function(){
   table.print(false, true);});



</script>

</body>
</html>